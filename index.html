<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FunkyWave</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
        color: #fff;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
      }

      .container {
        padding: 20px;
        text-align: center;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      h1 {
        margin-top: 0;
        color: #0ff;
        text-shadow: 0 0 10px #0ff;
      }

      .player {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        backdrop-filter: blur(10px);
      }

      .track-info {
        margin-bottom: 15px;
      }

      .track-name {
        font-size: 1.2em;
        font-weight: bold;
        margin: 5px 0;
      }

      .artist {
        color: #ccc;
      }

      .controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
      }

      button {
        background: none;
        border: 2px solid #0ff;
        color: #0ff;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        cursor: pointer;
        font-size: 1.5em;
        display: flex;
        justify-content: center;
        align-items: center;
        box-shadow: 0 0 5px #0ff;
        transition: all 0.3s ease;
      }

      button:hover {
        background: rgba(0, 255, 255, 0.2);
      }

      button:active {
        transform: scale(0.95);
      }

      .playlist {
        flex-grow: 1;
        overflow-y: auto;
        margin-top: 20px;
        text-align: left;
      }

      .playlist-item {
        padding: 10px 15px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        cursor: pointer;
        transition: background 0.3s;
        border-radius: 5px;
      }

      .playlist-item:hover {
        background: rgba(0, 255, 255, 0.1);
      }

      .playlist-item.active {
        background: rgba(0, 255, 255, 0.2);
        color: #0ff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéµ FunkyWave</h1>

      <div class="player">
        <div class="track-info">
          <div class="track-name" id="currentTrack">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫</div>
          <div class="artist" id="currentArtist">–∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞</div>
        </div>
        <div class="controls">
          <button id="prevBtn">‚èÆ</button>
          <button id="playBtn">‚ñ∂</button>
          <button id="pauseBtn" style="display: none">‚è∏</button>
          <button id="nextBtn">‚è≠</button>
        </div>
      </div>

      <div class="playlist" id="playlist">
        <!-- –ü–ª–µ–π–ª–∏—Å—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –∑–¥–µ—Å—å -->
      </div>
    </div>

    <script>
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
      let tg = window.Telegram.WebApp;
      tg.expand(); // –†–∞—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
      tg.enableClosingConfirmation(); // –í–∫–ª—é—á–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è

      // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
      const playBtn = document.getElementById("playBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const currentTrackEl = document.getElementById("currentTrack");
      const currentArtistEl = document.getElementById("currentArtist");
      const playlistEl = document.getElementById("playlist");

      // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–µ–µ—Ä–∞
      let playerState = {
        isPlaying: false,
        currentTrackIndex: null,
        audioPlayer: new Audio(),
        playlist: [], // –ú–∞—Å—Å–∏–≤ —Ç—Ä–µ–∫–æ–≤ {id: number, title: string, artist: string, file_url: string}
      };

      // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ - —Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞)
      function loadPlaylist() {
        // –ó–ê–ì–õ–£–®–ö–ê: –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å fetch –∫ –≤–∞—à–µ–º—É API
        const fakePlaylist = [
          {
            id: 1,
            title: "Night Drive",
            artist: "Vadim Mazaev",
            file_url: "https://example.com/track1.mp3",
          },
          {
            id: 2,
            title: "Neon Dreams",
            artist: "Lux FM",
            file_url: "https://example.com/track2.mp3",
          },
          {
            id: 3,
            title: "Skyline",
            artist: "DJ Funk",
            file_url: "https://example.com/track3.mp3",
          },
        ];

        playerState.playlist = fakePlaylist;
        renderPlaylist();
      }

      // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞
      function renderPlaylist() {
        playlistEl.innerHTML = "";
        playerState.playlist.forEach((track, index) => {
          const item = document.createElement("div");
          item.className = "playlist-item";
          if (index === playerState.currentTrackIndex) {
            item.classList.add("active");
          }
          item.innerHTML = `<b>${track.title}</b> - ${track.artist}`;
          item.addEventListener("click", () => {
            playTrack(index);
          });
          playlistEl.appendChild(item);
        });
      }

      // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞
      function playTrack(index) {
        if (index < 0 || index >= playerState.playlist.length) return;

        const track = playerState.playlist[index];
        playerState.currentTrackIndex = index;

        currentTrackEl.textContent = track.title;
        currentArtistEl.textContent = track.artist;

        playerState.audioPlayer.src = track.file_url;
        playerState.audioPlayer.play();
        playerState.isPlaying = true;

        playBtn.style.display = "none";
        pauseBtn.style.display = "flex";

        renderPlaylist(); // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞
      }

      // –ü–∞—É–∑–∞
      function pauseTrack() {
        playerState.audioPlayer.pause();
        playerState.isPlaying = false;
        pauseBtn.style.display = "none";
        playBtn.style.display = "flex";
      }

      // –°–ª–µ–¥—É—é—â–∏–π —Ç—Ä–µ–∫
      function nextTrack() {
        let nextIndex = playerState.currentTrackIndex + 1;
        if (nextIndex >= playerState.playlist.length) nextIndex = 0; // –ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ
        playTrack(nextIndex);
      }

      // –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—Ä–µ–∫
      function prevTrack() {
        let prevIndex = playerState.currentTrackIndex - 1;
        if (prevIndex < 0) prevIndex = playerState.playlist.length - 1; // –ó–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏–µ
        playTrack(prevIndex);
      }

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      playBtn.addEventListener("click", () => {
        if (playerState.currentTrackIndex === null) {
          // –ï—Å–ª–∏ —Ç—Ä–µ–∫ –µ—â–µ –Ω–µ –≤—ã–±—Ä–∞–Ω, –Ω–∞—á–∏–Ω–∞–µ–º —Å –ø–µ—Ä–≤–æ–≥–æ
          playTrack(0);
        } else {
          // –ï—Å–ª–∏ —Ç—Ä–µ–∫ —É–∂–µ –±—ã–ª –≤—ã–±—Ä–∞–Ω, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
          playerState.audioPlayer.play();
          playerState.isPlaying = true;
          playBtn.style.display = "none";
          pauseBtn.style.display = "flex";
        }
      });

      pauseBtn.addEventListener("click", pauseTrack);
      nextBtn.addEventListener("click", nextTrack);
      prevBtn.addEventListener("click", prevTrack);

      // –ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ç—Ä–µ–∫—É –ø–æ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ
      playerState.audioPlayer.addEventListener("ended", nextTrack);

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      loadPlaylist();
    </script>
  </body>
</html>
